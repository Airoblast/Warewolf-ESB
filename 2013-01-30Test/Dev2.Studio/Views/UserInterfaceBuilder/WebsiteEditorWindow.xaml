<UserControl x:Class="Unlimited.Applications.BusinessDesignStudio.Views.WebsiteBuilder.WebsiteEditorWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ap="clr-namespace:Dev2.Studio.AppResources.AttachedProperties"     
    xmlns:bds="clr-namespace:Unlimited.Applications.BusinessDesignStudio"                    
    xmlns:avalonEdit="http://icsharpcode.net/sharpdevelop/avalonedit"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    mc:Ignorable="d"
    xmlns:uf="clr-namespace:Dev2.Studio.Core.Interfaces;assembly=Dev2.Studio.Core"                       
    xmlns:cs="clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf"
    ap:UIElementTitleProperty.Title="Website Editor"
    >
    
    <UserControl.InputBindings>
        <KeyBinding Command="{Binding Path=CopyCommand}" Key="C" Modifiers="Control" />
    </UserControl.InputBindings>
    <Grid>
            <TabControl x:Name="layoutTab" SelectionChanged="layoutTab_SelectionChanged">
                <TabItem Header="Website" IsEnabled="{Binding IsValidMarkup}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="400" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="110" />
                                <ColumnDefinition />
                                <ColumnDefinition Width="20" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30" />
                                <RowDefinition Height="1" />
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="1"/>
                                <RowDefinition Height="30"/>
                                <RowDefinition Height="1"/>
                                <RowDefinition Height="250"/>
                                <RowDefinition Height="1"/>
                                <RowDefinition Height="50"/>
                                <RowDefinition Height="3"/>
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <TextBlock Text="URL:" Grid.Row="0" Grid.Column="0" HorizontalAlignment="Right" Margin="0,0,5,0" VerticalAlignment="Center" />
                        <Label Content="{Binding URL}" Grid.Row="0" Grid.Column="1" AutomationProperties.AutomationId="UI_WebsiteEditorUrlLabel_AutoID" />

                            <TextBlock Text="Name:" Grid.Row="2" Grid.Column="0" HorizontalAlignment="Right" Margin="0,0,5,0" VerticalAlignment="Center" />
                        <Label Content="{Binding ResourceName}" Grid.Row="2" Grid.Column="1" AutomationProperties.AutomationId="UI_WebsiteEditorNameLabel_AutoID" />

                            <TextBlock Text="Default Web Page:" Grid.Row="4" Grid.Column="0" HorizontalAlignment="Right" Margin="0,0,5,0" VerticalAlignment="Center" />
                            <ComboBox Grid.Column="1" Grid.Row="4" ItemsSource="{Binding WebpageServices}" DisplayMemberPath="ResourceName" SelectedValue="{Binding SelectedDefaultWebpage}" IsSynchronizedWithCurrentItem="True" AutomationProperties.AutomationId="UI_DefaultWebPageCombo_AutoID">
                            </ComboBox>


                            <TextBlock Text="Resources:" Grid.Column="0" Grid.Row="6" HorizontalAlignment="Right" Margin="0,0,5,0"/>
                            <Grid Grid.Column="1" Grid.Row="6">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="25"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Button Content="Upload" Command="{Binding AddExistingWebResourceCommand}" CommandParameter="{Binding}" Grid.Column="0" AutomationProperties.AutomationId="UI_WebsiteEditorUploadBtn_AutoID">
                                        <Button.Style>
                                            <Style TargetType="{x:Type Button}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ElementName=webResourceTreeView, Path=SelectedItem}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                <Button Content="Delete" Command="{Binding RemoveWebResourceCommand}" Grid.Column="1" AutomationProperties.AutomationId="UI_WebsiteEditorUploadBtn_AutoID">
                                        <Button.Style>
                                            <Style TargetType="{x:Type Button}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ElementName=webResourceTreeView, Path=SelectedItem}" Value="{x:Null}">
                                                        <Setter Property="IsEnabled" Value="False"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>
                                <!--<ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Grid.Row="1">-->
                                <TreeView Name="webResourceTreeView" TreeViewItem.Selected="webResourceTreeView_Selected" ItemsSource="{Binding RootWebResource.Children}" Grid.Row="1" ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Auto"   >
                                    <TreeView.ItemContainerStyle>
                                        <Style TargetType="{x:Type TreeViewItem}">
                                            <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                                            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                                            <Setter Property="FontWeight" Value="Normal" />
                                            <Setter Property="bds:BringIntoViewProperty.IsInView" Value="{Binding IsSelected}" />
                                        <Setter Property="AutomationProperties.AutomationId">
                                            <Setter.Value>
                                                <MultiBinding StringFormat="UI_WebsiteEditor{0}Resource_AutoID">
                                                    <Binding Path="DataContext.Name" />
                                                </MultiBinding>
                                            </Setter.Value>
                                        </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter Property="FontWeight" Value="Bold" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TreeView.ItemContainerStyle>

                                    <TreeView.ItemTemplate>
                                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                            <TextBlock Text="{Binding Name}" >
                                                <TextBlock.ContextMenu>
                                                    <ContextMenu>
                                                      <MenuItem Header="Copy" Command="{Binding CopyCommand}" AutomationProperties.AutomationId="UI_WebsiteEditorCopyMenuItem_AutoID" />
                                                    </ContextMenu>
                                                </TextBlock.ContextMenu>
                                            </TextBlock>
                                        </HierarchicalDataTemplate>
                                    </TreeView.ItemTemplate>
                                </TreeView>
                                <!--</ScrollViewer>-->

                            </Grid>


                            <TextBlock Text="Search Engine Keywords:" Margin="0,0,5,0" Grid.Column="0" Grid.Row="8" MaxWidth="100" TextWrapping="Wrap" HorizontalAlignment="Right"  />
                            <TextBox AcceptsReturn="True" MaxLines="10" Text="{Binding MetaTags}" Grid.Row="8" Grid.Column="1" ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto" TextWrapping="Wrap" />

                            <GridSplitter Grid.ColumnSpan="3" Grid.Row="9" Height="3" HorizontalAlignment="Stretch" VerticalAlignment="Top" BorderThickness="0,1,0,1" BorderBrush="Black"/>

                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Grid.ColumnSpan="3" Grid.Row="10">
                                <ItemsControl ItemsSource="{Binding LayoutObjects}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="uf:ILayoutObjectViewModel">
                                            <Border AllowDrop="True"  Background="LightGray" Margin="1,1,1,1" PreviewMouseDown="Border_PreviewMouseDown">
                                                <StackPanel MouseDown="StackPanel_MouseDown" x:Name="cellView">
                                                    <StackPanel.Style>
                                                        <Style TargetType="StackPanel">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                                    <Setter Property="Background" Value="LightBlue" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding IsSelected}" Value="False">
                                                                    <Setter Property="Background" Value="LightGray" />
                                                                </DataTrigger>
                                                            </Style.Triggers>

                                                        </Style>
                                                    </StackPanel.Style>
                                                    <Grid IsHitTestVisible="False">
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition />
                                                            <RowDefinition Height="35" />
                                                            <RowDefinition Height="35"/>
                                                        </Grid.RowDefinitions>

                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="40" />
                                                            <ColumnDefinition/>
                                                        </Grid.ColumnDefinitions>

                                                        <Image Width="35" Height="35" Margin="3,0" Source="{Binding IconPath, Converter={StaticResource ImagePathConverter}}" />
                                                    <TextBlock Text="{Binding WebpartServiceDisplayName}" MaxWidth="110" MaxHeight="35" Grid.Column="1" FontWeight="Bold" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" FontSize="13" AutomationProperties.AutomationId="UI_WebsiteEditorWebpartServiceDisplayNameTxt_AutoID" />
                                                        <TextBlock Grid.ColumnSpan="2" Grid.Row="1" MaxWidth="110" MaxHeight="35" Text="{Binding DisplayName}" HorizontalAlignment="Center" TextWrapping="Wrap" TextTrimming="CharacterEllipsis">

                                                        </TextBlock>
                                                    </Grid>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                        
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                        <GridSplitter Grid.Column="0" Width="3" HorizontalAlignment="Right" VerticalAlignment="Stretch" BorderThickness="1,0,1,0" BorderBrush="Black"/>
                    <cs:WebView x:Name="webBrowser"  Grid.Column="1">
                        <cs:WebView.ContextMenu>
                            <ContextMenu />
                        </cs:WebView.ContextMenu>
                    </cs:WebView>
                </Grid>
                </TabItem>
                <TabItem Header="Html">
                    <avalonEdit:TextEditor 
                        x:Name="txtHtml"
                        ScrollViewer.VerticalScrollBarVisibility="Auto" 
                        ScrollViewer.HorizontalScrollBarVisibility="Auto" 
                        FontFamily="Consolas" 
                        FontSize="18" 
                        ShowLineNumbers="True" 
                        SyntaxHighlighting="HTML"
                        />
                </TabItem>


            </TabControl>
        </Grid>
</UserControl>
