<UserControl x:Class="Dev2.Studio.Views.Diagnostics.DebugOutputView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"                     
             xmlns:b="clr-namespace:Dev2.Studio.AppResources.Behaviors"
             xmlns:Diagnostics="clr-namespace:Dev2.Studio.Diagnostics"
             xmlns:Converters="clr-namespace:Dev2.Studio.AppResources.Converters"
             xmlns:LocalDiagnostics="clr-namespace:Dev2.Studio.ViewModels.Diagnostics"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d"
    Name="DebugOutput">
    <Grid>
        <Grid.Resources>
            <Style x:Key="SimulationModeVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Content.IsSimulation}" Value="True" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="VersionVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ShowVersion, ElementName=DebugOutput}" Value="True" />
                            <Condition Binding="{Binding AddedAsParent}" Value="False" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="ServerVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                    <Setter Property="AutomationProperties.AutomationId" Value="UI_DebugShowType_AutoID" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ShowServer, ElementName=DebugOutput}" Value="True" />
                            <Condition Binding="{Binding Content.ActivityType, Converter={StaticResource EnumToVisibilityConverterActivityTypeWorkflow}}" Value="Visible" />
                            <Condition Binding="{Binding AddedAsParent}" Value="False" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="TypeVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ShowType, ElementName=DebugOutput}" Value="True" />
                            <Condition Binding="{Binding Content.ActivityType, Converter={StaticResource EnumToVisibilityConverterActivityTypeStep}}" Value="Visible" />
                            <Condition Binding="{Binding AddedAsParent}" Value="False" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="StartTimeVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ShowTime, ElementName=DebugOutput}" Value="True" />
                            <Condition Binding="{Binding Content.ActivityType, Converter={StaticResource EnumToVisibilityConverterActivityTypeWorkflow}}" Value="Visible" />
                            <Condition Binding="{Binding Content.StateType, Converter={StaticResource EnumToVisibilityConverterStateTypeBefore}}" Value="Visible" />
                            <Condition Binding="{Binding AddedAsParent}" Value="False" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="EndTimeVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ShowTime, ElementName=DebugOutput}" Value="True" />
                            <Condition Binding="{Binding Content.ActivityType, Converter={StaticResource EnumToVisibilityConverterActivityTypeWorkflow}}" Value="Visible" />
                            <Condition Binding="{Binding Content.StateType, Converter={StaticResource EnumToVisibilityConverterStateTypeAfter}}" Value="Visible" />
                            <Condition Binding="{Binding AddedAsParent}" Value="False" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="DurationVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ShowDuratrion, ElementName=DebugOutput}" Value="True" />
                            <Condition Binding="{Binding Content.ActivityType, Converter={StaticResource EnumToVisibilityConverterActivityTypeStep}}" Value="Visible" />
                            <Condition Binding="{Binding AddedAsParent}" Value="False" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="InputsVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ShowInputs, ElementName=DebugOutput}" Value="True" />
                            <Condition Binding="{Binding Content.Inputs, Converter={StaticResource CountToVisibilityConverter}}" Value="Visible" />
                            <Condition Binding="{Binding AddedAsParent}" Value="False" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="OutputsVisibility">
                <Style.Setters>
                    <Setter Property="FrameworkElement.Visibility" Value="Collapsed" />
                </Style.Setters>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ShowOutputs, ElementName=DebugOutput}" Value="True" />
                            <Condition Binding="{Binding Content.Outputs, Converter={StaticResource CountToVisibilityConverter}}" Value="Visible" />
                            <Condition Binding="{Binding AddedAsParent}" Value="False" />
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter Property="FrameworkElement.Visibility" Value="Visible" />
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Resources>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <Popup x:Name="OptionsPopup" PlacementTarget="{Binding ElementName=OptionsButton}" IsOpen="{Binding Path=ShowOptions}" 
               Placement="Bottom" Focusable="False" StaysOpen="False" AutomationProperties.AutomationId="UI_DebugOutputOptionsPopup">
            <i:Interaction.Behaviors>
                <b:PopupBuildVisualTreeOnLoad />
            </i:Interaction.Behaviors>            
            <Border Background="White" BorderBrush="LightGray" BorderThickness="1" Padding="2">
                <StackPanel>
                    <CheckBox IsChecked="{Binding ShowVersion}" Content="Version" AutomationProperties.AutomationId="UI_DebugOutputShowVersionOption_AutoID" />
                    <CheckBox IsChecked="{Binding ShowType}" Content="Type" AutomationProperties.AutomationId="UI_DebugOutputShowTypeOption_AutoID" />
                    <CheckBox IsChecked="{Binding ShowTime}" Content="Time" AutomationProperties.AutomationId="UI_DebugOutputShowTimeOption_AutoID" />
                    <CheckBox IsChecked="{Binding ShowDuratrion}" Content="Duration" AutomationProperties.AutomationId="UI_DebugOutputShowDuration_AutoID" />
                    <CheckBox IsChecked="{Binding ShowInputs}" Content="Inputs" AutomationProperties.AutomationId="UI_DebugOutputShowInputsOption_AutoID" />
                    <CheckBox IsChecked="{Binding ShowOutputs}" Content="Outputs" AutomationProperties.AutomationId="UI_DebugOutputShowOutputsOption_AutoID" />
                    <CheckBox IsChecked="{Binding HighlighSimulation}" Content="Hilight Simulation" AutomationProperties.AutomationId="UI_DebugOutputHilightSimulationOption_AutoID" />
                    <StackPanel Orientation="Horizontal">
                        <TextBox Width="20" Text="{Binding DepthLimit, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        <TextBlock Text="Nesting Levels" Margin="5,0,0,0" VerticalAlignment="Center" AutomationProperties.AutomationId="UI_DebugOutputNestingLevelTextBlock_AutoID" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Popup>
       
        <StackPanel Orientation="Horizontal">
            <TextBox HorizontalAlignment="Stretch" Text="{Binding Path=SearchText, UpdateSourceTrigger=PropertyChanged}" MinWidth="100" AutomationProperties.AutomationId="UI_DebugOutputSearchTextBlock_AutoID">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <Style.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter Property="Background" Value="{StaticResource SearchHint}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </TextBox.Style>
            </TextBox>

            <Button x:Name="OptionsButton" Content="Options" Command="{Binding ShowOptionsCommand}" Margin="5,0,0,0" AutomationProperties.AutomationId="UI_DebugOutputOptionsButton_AutoID">
                <i:Interaction.Behaviors>
                    <b:ButtonPopupWorkaroundBehavior IsInWorkaroundState="{Binding SkipOptionsCommandExecute, Mode=TwoWay}" />
                </i:Interaction.Behaviors>
            </Button>

            <Button Content="{Binding ExpandAllMode, Converter={StaticResource BoolToPlusMinusConverter}}" Command="{Binding ExpandAllCommand}" Margin="5,0,0,0"
                    Width="20" AutomationProperties.AutomationId="UI_DebugOutputExpandAllMode_AutoID" />
        </StackPanel>
       
        <TreeView Grid.Row="1" ItemsSource="{Binding RootItems}">
            <i:Interaction.Behaviors>
                <b:TreeviewScrollToEndOnNewContent />
            </i:Interaction.Behaviors>
            <TreeView.Resources>
                <DataTemplate x:Key="ResultDataTemplate">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="{Binding Variable}" Foreground="Purple" Visibility="{Binding Variable, Converter={StaticResource StringToVisibilityConverter}}"/>
                        <!--<TextBlock Grid.Column="1" Text="=" Margin="3,0,3,0" Visibility="{Binding Variable, Converter={StaticResource StringToVisibilityConverter}}"/>-->

                        <!--<TextBlock Grid.Column="1" Text="=" 
                                   Margin="3,0,3,0" >
                            <TextBlock.Visibility>
                                <MultiBinding Converter="{StaticResource MultipleStringToVisilityValueConverter}">
                                    <Binding Path="Variable"/>
                                    <Binding Path="Value"/>
                                </MultiBinding>
                            </TextBlock.Visibility>
                        </TextBlock>-->
                        
                        <TextBlock Grid.Column="2" Text="{Binding Value}" Margin="3,0,3,0" />
                    </Grid>
                </DataTemplate>
                <DataTemplate x:Key="DefaultScalarInputOutputTemplate">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="{Binding Label}" Margin="0,0,3,0"/>
                        <ItemsControl Grid.Column="1"  ItemTemplate="{StaticResource ResultDataTemplate}" ItemsSource="{Binding Results}" >
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </Grid>
                </DataTemplate>

                <DataTemplate x:Key="DefaultRecordSetInputOutputTemplate">
                    <Expander Header="{Binding Name}"
                        AutomationProperties.AutomationId="UI_DefaultRecordSetIOTemplate_AutoID">
                        <ItemsControl MaxHeight="320" ItemsSource="{Binding Items}"
                                      HorizontalAlignment="Stretch"
                                      HorizontalContentAlignment="Stretch"
                            ItemTemplate="{StaticResource DefaultScalarInputOutputTemplate}">
                            <ItemsControl.Template>
                                <ControlTemplate>
                                    <ScrollViewer HorizontalAlignment="Stretch" 
                                                  VerticalScrollBarVisibility="Auto"
                                                  CanContentScroll="True" Grid.Row="1">
                                        <VirtualizingStackPanel HorizontalAlignment="Stretch" IsItemsHost="True" />
                                    </ScrollViewer>
                                </ControlTemplate>
                            </ItemsControl.Template>
                        </ItemsControl>
                    </Expander>
                </DataTemplate>

                <DataTemplate x:Key="NotFoundInputOutputTemplate">
                    <TextBlock Text="No Template found!" />
                </DataTemplate>

                <Diagnostics:InputOutputDataTemplateSelector x:Key="DefaultTemplateSelector" ScalarTemplate="{StaticResource NotFoundInputOutputTemplate}"
                                                             RecordSetTemplate="{StaticResource NotFoundInputOutputTemplate}"/>

                <Diagnostics:InputOutputDataTemplateSelectorCollection x:Key="InputOutputTemplateSelectors">
                    <Diagnostics:InputOutputDataTemplateSelector Key="CommentActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfFlowDecisionActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}" />
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfFlowSwitchActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}" />
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}" />
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfWorkflowActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="AssertActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfAssignActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfBaseConvertActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfCalculateActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfCaseConvertActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfCheckpointActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfCommentActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfCountRecordsetActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfDeleteRecordActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfTagCountActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfDataSplitActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfIndexActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfDataMergeActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfDataValidationActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfDateTimeActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfDateTimeDifferenceActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfFileForEachActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfFindRecordsActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfForEachActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfHttpActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfMultiAssignActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfRemoteActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfReplaceActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfRemoveActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfReturnToCallerActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfSortRecordsActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfWebPageActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfWebSiteActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfNumberFormatActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="TransformActivity" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>

                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfFileRead" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfFileWrite" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfFolderRead" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfPathCopy" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfPathCreate" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfPathDelete" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfPathMove" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfPathRename" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfUnZip" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                    <Diagnostics:InputOutputDataTemplateSelector Key="DsfZip" ScalarTemplate="{StaticResource DefaultScalarInputOutputTemplate}" RecordSetTemplate="{StaticResource DefaultRecordSetInputOutputTemplate}"/>
                </Diagnostics:InputOutputDataTemplateSelectorCollection>

                <Converters:IDebugStateToTemplateSelectorConverter x:Key="IDebugStateToTemplateSelectorConverter" DataTemplateSelectors="{StaticResource InputOutputTemplateSelectors}"
                                                           DefaultTemplateSelector="{StaticResource DefaultTemplateSelector}"/>
                
                <HierarchicalDataTemplate ItemsSource="{Binding Children}" DataType="{x:Type LocalDiagnostics:DebugStringTreeViewItemViewModel}">
                    <TextBlock Text="{Binding Content}" HorizontalAlignment="Stretch"/>
                </HierarchicalDataTemplate>

                <HierarchicalDataTemplate ItemsSource="{Binding Children}" DataType="{x:Type LocalDiagnostics:DebugStateTreeViewItemViewModel}">
                    <Grid HorizontalAlignment="Stretch">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" >
                            <Run Text="{Binding Content.ActivityType, Converter={StaticResource EnumToStringConverter}}" />
                            <Run Text=": " />
                        </TextBlock>
                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal">
                            <Button Content="{Binding Content.DisplayName}" Command="{Binding DataContext.OpenItemCommand, ElementName=DebugOutput}" 
                                CommandParameter="{Binding Content}" Style="{StaticResource LinkButton}" HorizontalAlignment="Left" 
                                IsEnabled="{Binding Content.ActivityType, Converter={StaticResource EnumToBoolConverterActivityTypeWorkflow}}" />
                            <TextBlock Text="(In Simulation Mode)" Style="{StaticResource SimulationModeVisibility}" Margin="5,0,0,0" />
                        </StackPanel>

                        <TextBlock Grid.Row="1" Grid.Column="0" Style="{StaticResource VersionVisibility}">
                            <Run Text="Version" />
                            <Run Text=": " />
                        </TextBlock>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Content.Version}" Style="{StaticResource VersionVisibility}" AutomationProperties.AutomationId="UI_DebugOutputVersionTextBlock_AutoId" />

                        <TextBlock Grid.Row="2" Grid.Column="0" Style="{StaticResource ServerVisibility}">
                            <Run Text="Server" />
                            <Run Text=": " />
                        </TextBlock>
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding Content.Server}" Style="{StaticResource ServerVisibility}" />

                        <TextBlock Grid.Row="3" Grid.Column="0" Style="{StaticResource TypeVisibility}">
                            <Run Text="Type" />
                            <Run Text=": " />
                        </TextBlock>
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding Content.Name}" Style="{StaticResource TypeVisibility}" AutomationProperties.AutomationId="UI_DebugOutputTypeTextBlock_AutoId"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Style="{StaticResource StartTimeVisibility}">
                            <Run Text="Time" />
                            <Run Text=": " />
                        </TextBlock>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding Content.StartTime, Converter={StaticResource DateTimeToStringConverter}}" 
                                    Style="{StaticResource StartTimeVisibility}" AutomationProperties.AutomationId="UI_DebugOutputStartTimeTextBlock_AutoId"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Style="{StaticResource EndTimeVisibility}">
                            <Run Text="Time" />
                            <Run Text=": " />
                        </TextBlock>
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding Content.EndTime, Converter={StaticResource DateTimeToStringConverter}}" 
                                    Style="{StaticResource EndTimeVisibility}" AutomationProperties.AutomationId="UI_DebugOutputTimeTextBlock_AutoId" />

                        <TextBlock Grid.Row="5" Grid.Column="0" Style="{StaticResource DurationVisibility}">
                            <Run Text="Duration" />
                            <Run Text=": " />
                        </TextBlock>
                        <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding Content.Duration, Converter={StaticResource TimeSpanToStringConverter}}" 
                                    Style="{StaticResource DurationVisibility}"/>

                        <TextBlock Grid.Row="6" Grid.Column="0" Style="{StaticResource InputsVisibility}">
                            <Run Text="Inputs" />
                            <Run Text=": " />
                        </TextBlock>
                        <StackPanel Grid.Row="6" Grid.Column="1" Orientation="Horizontal" Grid.IsSharedSizeScope="True"
                                Style="{StaticResource InputsVisibility}">
                            <ItemsControl ItemsSource="{Binding Inputs}" ItemTemplateSelector="{Binding Content, Converter={StaticResource IDebugStateToTemplateSelectorConverter}}" AutomationProperties.AutomationId="UI_DebugOutputInputPanel_AutoId" />
                        </StackPanel>

                        <TextBlock Grid.Row="7" Grid.Column="0" Style="{StaticResource OutputsVisibility}">
                            <Run Text="Outputs" />
                            <Run Text=": " />
                        </TextBlock>
                        <StackPanel Grid.Row="7" Grid.Column="1" Orientation="Horizontal" Grid.IsSharedSizeScope="True"
                                    Style="{StaticResource OutputsVisibility}">
                            <ItemsControl ItemsSource="{Binding Outputs}" ItemTemplateSelector="{Binding Content, Converter={StaticResource IDebugStateToTemplateSelectorConverter}}" 
                                          AutomationProperties.AutomationId="UI_DebugOutputOutputPanel_AutoId" />
                        </StackPanel>
                    </Grid>
                </HierarchicalDataTemplate>
            </TreeView.Resources>

            <TreeView.ItemContainerStyle>
                <!-- 
                    This Style binds a TreeViewItem to a DebugItemViewModel. 
                -->
                <Style TargetType="{x:Type TreeViewItem}" BasedOn="{StaticResource DebugTreeStyle}">
                    <Setter Property="HorizontalContentAlignment"  Value="Stretch" />
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                    <Setter Property="FontWeight" Value="Normal" />
                    <Setter Property="Padding" Value="0,0,0,2.5" />
                    <Setter Property="Panel.Background" Value="White" />
                    <Setter Property="AutomationProperties.AutomationId" Value="{Binding Content.Name}" />
                    <Style.Triggers>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding DataContext.HighlighSimulation, ElementName=DebugOutput}" Value="True" />
                                <Condition Binding="{Binding Content.IsSimulation}" Value="True" />
                            </MultiDataTrigger.Conditions>
                            <MultiDataTrigger.Setters>
                                <Setter Property="Panel.Background" Value="LightYellow" />
                            </MultiDataTrigger.Setters>
                        </MultiDataTrigger>
                        
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding DataContext.HighlighError, ElementName=DebugOutput}" Value="True" />
                                <Condition Binding="{Binding Content.HasError}" Value="True" />
                            </MultiDataTrigger.Conditions>
                            <MultiDataTrigger.Setters>
                                <Setter Property="Border.Background" Value="#FFFFADB2" />
                            </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                    </Style.Triggers>
                </Style>
            </TreeView.ItemContainerStyle>
        </TreeView>
    </Grid>
</UserControl>
