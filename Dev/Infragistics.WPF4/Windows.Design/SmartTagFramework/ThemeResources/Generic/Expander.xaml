<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:stf="clr-namespace:Infragistics.Windows.Design.SmartTagFramework"
    xmlns:controls="clr-namespace:System.Windows.Controls;assembly=PresentationFramework"
    >
    <controls:BooleanToVisibilityConverter x:Key="booleanToVisibilityConverter"/>

    <Style x:Key="{ComponentResourceKey TypeInTargetAssembly={x:Type stf:GenericAdorner}, ResourceId=Expander}" TargetType="{x:Type Expander}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type Expander}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <ToggleButton Background="#FFE0E0E0"
                                      Visibility="{Binding Path=Items[0].DesignerActionItemGroup.IsHeaderVisible, Converter={StaticResource booleanToVisibilityConverter}}"                                                                                             
                                      HorizontalContentAlignment="Stretch"   
                                      IsChecked="{Binding Path=IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                      IsEnabled="{Binding Path=Items[0].DesignerActionItemGroup.IsExpandable}"
									  Foreground="Black"
									  FontSize="12"
                                      >

                            <ToggleButton.Template>
                                <ControlTemplate TargetType="{x:Type ToggleButton}">

                                    <Grid MinHeight="24">
                                        <Border x:Name="border" Background="{TemplateBinding Background}" BorderThickness="1" Margin="1,0,1,0" Padding="0,1,0,0" />
                                        <ContentPresenter 
                                            Margin="0,0,0,0"
                                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            VerticalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                           />
                                    </Grid>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="ToggleButton.IsMouseOver" Value="True">
                                            <Setter Property="Control.Cursor" Value="Hand" />
                                            <Setter TargetName="border"  Property="BorderBrush" Value="#FF3399FF" />
                                            <Setter TargetName="border"  Property="Background" Value="#FFC1E0E1" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </ToggleButton.Template>

                            <ToggleButton.Content>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>

                                    <ContentPresenter Grid.Column="0" ContentSource="Header" >
                                        <ContentPresenter.Content>
                                            <Label FontWeight="Bold" FontSize="12" Foreground="{TemplateBinding Foreground}" Content="{TemplateBinding Header}" Margin="4,0,0,0"/>
                                        </ContentPresenter.Content>
                                    </ContentPresenter>

                                    <Path       Grid.Column="1"
                                                SnapsToDevicePixels="True"
                                                IsHitTestVisible="False"
                                                x:Name="arrow"
                                                Margin="8,0,8,0"
                                                Fill="#0FFF"
                                                RenderTransformOrigin="0.5,0.5"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Data="M 0 0 L 0 8 L 5 4 Z"
                                                Stroke="{TemplateBinding Foreground}"
                                                StrokeThickness="0.5"
                                                Visibility="{Binding Path=Items[0].DesignerActionItemGroup.IsExpandable, Converter={StaticResource booleanToVisibilityConverter}}"                                                 
                                                >
                                        <Path.RenderTransform>
                                            <RotateTransform Angle="0" />
                                        </Path.RenderTransform>
                                    </Path>
                                </Grid>
                            </ToggleButton.Content>
                        </ToggleButton>

                        <stf:Reveal x:Name="ContentReveal" Grid.Row="1" VerticalReveal="FromTopToBottom" HorizontalReveal="None" IsExpanded="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}, Mode=OneWay}">
                            <ContentPresenter Content="{TemplateBinding Content}" />
                        </stf:Reveal>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsExpanded" Value="True">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation BeginTime="0:0:0.2"  Storyboard.TargetName="ContentReveal" Storyboard.TargetProperty="AnimationProgress" Duration="0:0:0.2" To="1" DecelerationRatio="1" />
                                        <DoubleAnimation Storyboard.TargetName="arrow" Storyboard.TargetProperty="(FrameworkElement.RenderTransform).(RotateTransform.Angle)" Duration="0:0:0.2" To="90" DecelerationRatio="1" />
                                        <ColorAnimation Storyboard.TargetName="arrow" Storyboard.TargetProperty="(Path.Fill).(SolidColorBrush.Color)" Duration="0:0:0.2" To="#FF000000" DecelerationRatio="1" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="ContentReveal" Storyboard.TargetProperty="AnimationProgress" Duration="0:0:0.2" AccelerationRatio="1" />
                                        <DoubleAnimation  Storyboard.TargetName="arrow" Storyboard.TargetProperty="(FrameworkElement.RenderTransform).(RotateTransform.Angle)" Duration="0:0:0.2" AccelerationRatio="1" />
                                        <ColorAnimation Storyboard.TargetName="arrow" Storyboard.TargetProperty="(Path.Fill).(SolidColorBrush.Color)" Duration="0:0:0.2" AccelerationRatio="1" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
					</ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>